<!-- Application Management Modal -->
<div *ngIf="show" class="modal-backdrop" (click)="onCloseModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="flex items-center">
        <div class="h-10 w-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm">
          <i class="fas fa-mobile-alt"></i>
        </div>
        <div>
          <h3>{{ mode === 'create' ? 'Add New Application' : 'Edit Application' }}</h3>
          <p class="text-xs text-gray-600 mt-1">{{ mode === 'create' ? 'Create a new application for the home page' : 'Update application details' }}</p>
        </div>
      </div>
      <button type="button" (click)="onCloseModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
        <i class="fas fa-times text-lg"></i>
      </button>
    </div>

    <form #applicationForm="ngForm" (ngSubmit)="onSubmit(applicationForm)" class="modal-body">
      <!-- Application Title -->
      <div class="form-group">
        <label class="form-label">
          <i class="fas fa-heading text-blue-600 mr-2"></i>
          Application Title *
        </label>
        <input
          type="text"
          name="title"
          [(ngModel)]="formData.title"
          #titleField="ngModel"
          required
          maxlength="100"
          placeholder="e.g., Chemical Product Management"
          class="form-input"
          [class.error]="titleField.invalid && (titleField.dirty || titleField.touched)">
        <div *ngIf="titleField.invalid && (titleField.dirty || titleField.touched)" class="error-message">
          <span *ngIf="titleField.errors?.['required']">Application title is required</span>
          <span *ngIf="titleField.errors?.['maxlength']">Title cannot exceed 100 characters</span>
        </div>
      </div>

      <!-- Application Icon -->
      <div class="form-group">
        <label class="form-label">
          <i class="fas fa-icons text-blue-600 mr-2"></i>
          Icon/Emoji *
        </label>
        <div class="flex gap-3">
          <input
            type="text"
            name="icon"
            [(ngModel)]="formData.icon"
            #iconField="ngModel"
            required
            maxlength="10"
            placeholder="ðŸ§ª or fas fa-flask"
            class="form-input flex-1"
            [class.error]="iconField.invalid && (iconField.dirty || iconField.touched)">
          <div class="preview-icon">
            <span class="text-2xl" [innerHTML]="getIconPreview()"></span>
          </div>
        </div>
        <p class="text-xs text-gray-500 mt-1">Use emoji (ðŸ§ª) or Font Awesome class (fas fa-flask)</p>
        <div *ngIf="iconField.invalid && (iconField.dirty || iconField.touched)" class="error-message">
          <span *ngIf="iconField.errors?.['required']">Icon is required</span>
          <span *ngIf="iconField.errors?.['maxlength']">Icon cannot exceed 10 characters</span>
        </div>
      </div>

      <!-- Redirect URL -->
      <div class="form-group">
        <label class="form-label">
          <i class="fas fa-link text-blue-600 mr-2"></i>
          Redirect URL *
        </label>
        <input
          type="url"
          name="redirectUrl"
          [(ngModel)]="formData.redirectUrl"
          #urlField="ngModel"
          required
          placeholder="https://example.com or /internal-route"
          class="form-input"
          [class.error]="urlField.invalid && (urlField.dirty || urlField.touched)">
        <p class="text-xs text-gray-500 mt-1">Full URL (https://...) or internal route (/page)</p>
        <div *ngIf="urlField.invalid && (urlField.dirty || urlField.touched)" class="error-message">
          <span *ngIf="urlField.errors?.['required']">Redirect URL is required</span>
          <span *ngIf="urlField.errors?.['url']">Please enter a valid URL</span>
        </div>
      </div>

      <!-- Display Order -->
      <div class="form-group">
        <label class="form-label">
          <i class="fas fa-sort-numeric-up text-blue-600 mr-2"></i>
          Display Order
        </label>
        <input
          type="number"
          name="order"
          [(ngModel)]="formData.order"
          #orderField="ngModel"
          min="1"
          max="99"
          placeholder="1"
          class="form-input"
          [class.error]="orderField.invalid && (orderField.dirty || orderField.touched)">
        <p class="text-xs text-gray-500 mt-1">Lower numbers appear first (1 = first position)</p>
        <div *ngIf="orderField.invalid && (orderField.dirty || orderField.touched)" class="error-message">
          <span *ngIf="orderField.errors?.['min']">Order must be at least 1</span>
          <span *ngIf="orderField.errors?.['max']">Order cannot exceed 99</span>
        </div>
      </div>

      <!-- Active Status -->
      <div class="form-group">
        <label class="flex items-center">
          <input
            type="checkbox"
            name="isActive"
            [(ngModel)]="formData.isActive"
            class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2">
          <span class="ml-3 text-sm font-medium text-gray-700">Active</span>
        </label>
        <p class="mt-1 text-xs text-gray-500">When active, this application will be visible on the home page</p>
      </div>

      <!-- Preview Section -->
      <div class="form-group border-t pt-4">
        <label class="form-label">
          <i class="fas fa-eye text-blue-600 mr-2"></i>
          Preview
        </label>
        <div class="preview-container">
          <div class="app-item-preview">
            <span class="text-3xl" [innerHTML]="getIconPreview()"></span>
            <p>{{ formData.title || 'Application Title' }}</p>
          </div>
        </div>
      </div>

      <!-- Modal Actions -->
      <div class="modal-footer">
        <button
          type="button"
          (click)="onCloseModal()"
          class="btn-secondary">
          Cancel
        </button>
        <button
          type="submit"
          [disabled]="!applicationForm.form.valid || isLoading"
          class="btn-primary">
          <i class="fas fa-spinner fa-spin mr-2" *ngIf="isLoading"></i>
          <i class="fas" [ngClass]="mode === 'create' ? 'fa-plus' : 'fa-save'" *ngIf="!isLoading"></i>
          <span class="ml-2">{{ mode === 'create' ? 'Create Application' : 'Update Application' }}</span>
        </button>
      </div>
    </form>
  </div>
</div>