<div class="navbar-overlay"></div>
<header class="dashboard-header">
  <button class="hamburger" (click)="toggleSidebar()">â˜°</button>
  <div class="header-left">
    <h1 style="font-weight: bold;">{{ pageTitle }}</h1>
  </div>
  <div class="header-right">
    <!-- Notifications Dropdown -->
    <div class="notifications relative">
      <button 
        class="relative p-3 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200 cursor-pointer focus:outline-none"
        (click)="toggleNotificationDropdown()">
        <i class="fa-regular fa-bell text-xl"></i>
        <span 
          *ngIf="unreadCount > 0" 
          class="absolute top-1 right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse min-w-[20px]">
          {{ unreadCount > 9 ? '9+' : unreadCount }}
        </span>
      </button>

      <!-- Notification Dropdown -->
      <div 
        *ngIf="notificationDropdownOpen" 
        class="absolute right-0 mt-2 w-80 bg-white shadow-xl rounded-lg z-50 max-h-96 overflow-hidden border-0">
        <div class="px-4 py-3 border-b border-gray-200 flex justify-between items-center">
          <h3 class="text-lg font-semibold text-gray-900">Notifications</h3>
          <button 
            *ngIf="unreadCount > 0"
            (click)="markAllAsRead()"
            class="px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-all duration-200 cursor-pointer">
            Mark all read
          </button>
        </div>
        
        <div class="max-h-80 overflow-y-auto">
          <div *ngIf="notifications.length === 0" class="px-4 py-8 text-center text-gray-500">
            <i class="fas fa-bell-slash text-2xl mb-2"></i>
            <p class="text-sm">No notifications available</p>
            <p class="text-xs mt-1 text-gray-400">Connect to backend server to load notifications</p>
          </div>
          
          <div *ngFor="let notification of notifications" 
               class="px-4 py-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-all duration-200"
               [class.bg-blue-50]="!notification.isRead"
               (click)="markNotificationAsRead(notification)">
            <div class="flex items-start space-x-3">
              <div class="flex-shrink-0">
                <i [ngClass]="getNotificationIcon(notification.type)" class="text-lg"></i>
              </div>
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-gray-900 truncate">
                  {{ notification.title }}
                </p>
                <p class="text-xs text-gray-600 mt-1">
                  {{ notification.message }}
                </p>
                <div class="flex items-center justify-between mt-2">
                  <span class="text-xs text-gray-500">
                    {{ getRelativeTime(notification.createdAt) }}
                  </span>
                  <span 
                    class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                    [ngClass]="getTypeColor(notification.type)">
                    {{ notification.type }}
                  </span>
                </div>
              </div>
              <div *ngIf="!notification.isRead" class="flex-shrink-0">
                <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="px-4 py-3 border-t border-gray-200 text-center">
          <button class="px-4 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-all duration-200 cursor-pointer font-medium">
            View all notifications
          </button>
        </div>
      </div>
    </div>

    <!-- User Profile Dropdown -->
    <div class="profile relative">
      <button 
        class="flex items-center gap-2 cursor-pointer p-3 rounded-lg hover:bg-gray-100 transition-all duration-200 focus:outline-none"
        (click)="toggleUserDropdown()">
        <!-- User Avatar -->
        <div class="relative">
          <img *ngIf="cachedAvatarUrl; else defaultAvatar"
               [src]="cachedAvatarUrl"
               [alt]="getUserDisplayName() + ' avatar'"
               class="w-8 h-8 rounded-full object-cover shadow-md ring-2 ring-gray-200">
          <ng-template #defaultAvatar>
            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-sm shadow-md">
              {{ getUserInitials() }}
            </div>
          </ng-template>
        </div>
        <span class="text-sm font-medium text-gray-700 hidden md:block">{{ getUserDisplayName() }}</span>
        <i class="fa-solid fa-chevron-down text-gray-500 transition-transform duration-300" 
           [ngClass]="{'rotate-180': userDropdownOpen}"></i>
      </button>

      <!-- User Dropdown Menu -->
      <div 
        *ngIf="userDropdownOpen" 
        class="absolute right-0 mt-2 w-48 bg-white shadow-xl rounded-lg z-50 py-1 border-0">
        <div class="px-4 py-3 border-b border-gray-200">
          <p class="text-sm font-medium text-gray-900">{{ getUserDisplayName() }}</p>
          <p class="text-xs text-gray-600">{{ currentUser?.role || 'User' }}</p>
        </div>
        
        <button 
          class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-all duration-200 cursor-pointer"
          (click)="editProfile()">
          <i class="fas fa-user-edit mr-3 text-gray-500"></i>
          Edit Profile
        </button>
        
        <button 
          class="flex items-center w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-all duration-200 cursor-pointer"
          (click)="logout()">
          <i class="fas fa-sign-out-alt mr-3 text-red-500"></i>
          Logout
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Overlay to close dropdowns when clicking outside -->
<div 
  *ngIf="userDropdownOpen || notificationDropdownOpen" 
  class="fixed inset-0 z-40"
  (click)="closeDropdowns()">
</div>

<!-- Edit Profile Modal -->
<app-edit-user-modal
  [show]="showEditProfileModal"
  [user]="currentUser"
  [isLoading]="editProfileLoading"
  [error]="editProfileError"
  [title]="'Edit My Profile'"
  (closeModal)="closeEditProfileModal()"
  (submitForm)="submitEditProfile($event)">
</app-edit-user-modal>
