<div class="container mx-auto px-4 py-8 mt-15">
  <!-- Header -->
  <header class="mb-8">
    <h1 class="text-3xl font-bold text-gray-800">Actions Management Dashboard</h1>
    <p class="text-gray-600 mt-2">Track and manage all actions and subactions</p>
  </header>

  <!-- KPIs Section -->
  <section class="mb-10 grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="kpi-card bg-white rounded-lg shadow p-6 flex items-center">
      <div class="bg-blue-100 p-3 rounded-full mr-4">
        <i class="fas fa-tasks text-blue-600 text-xl"></i>
      </div>
      <div>
        <h3 class="text-gray-500 text-sm font-medium">Total Actions</h3>
        <p class="text-2xl font-bold text-gray-800">{{ totalActions }}</p>
      </div>
    </div>
    <div class="kpi-card bg-white rounded-lg shadow p-6 flex items-center">
      <div class="bg-green-100 p-3 rounded-full mr-4">
        <i class="fas fa-check-circle text-green-600 text-xl"></i>
      </div>
      <div>
        <h3 class="text-gray-500 text-sm font-medium">Completed</h3>
        <p class="text-2xl font-bold text-gray-800">{{ completedActions }}</p>
        <p class="text-xs text-gray-500">{{ completionRate }}</p>
      </div>
    </div>
    <div class="kpi-card bg-white rounded-lg shadow p-6 flex items-center">
      <div class="bg-yellow-100 p-3 rounded-full mr-4">
        <i class="fas fa-clock text-yellow-600 text-xl"></i>
      </div>
      <div>
        <h3 class="text-gray-500 text-sm font-medium">Overdue</h3>
        <p class="text-2xl font-bold text-gray-800">{{ overdueActions }}</p>
      </div>
    </div>
  </section>

  <!-- Filters -->
  <section class="mb-8 bg-white rounded-lg shadow p-6">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div class="w-full md:w-1/3">
        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
        <select class="w-full rounded-md border-gray-300 shadow-sm"
                [(ngModel)]="selectedStatus" (change)="filterActions()">
          <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
        </select>
      </div>
      <div class="w-full md:w-1/3">
        <label class="block text-sm font-medium text-gray-700 mb-1">Hierarchy</label>
        <select class="w-full rounded-md border-gray-300 shadow-sm"
                [(ngModel)]="selectedHierarchy" (change)="filterActions()">
          <option *ngFor="let h of hierarchies" [value]="h">{{ h }}</option>
        </select>
      </div>
      <div class="w-full md:w-1/3">
        <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
        <div class="relative">
          <input type="text" placeholder="Search actions..." [(ngModel)]="searchTerm"
                 (input)="filterActions()"
                 class="w-full rounded-md border-gray-300 shadow-sm pl-10">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <i class="fas fa-search text-gray-400"></i>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Actions List -->
  <section>
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold text-gray-800">All Actions</h2>
      <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center">
        <i class="fas fa-plus mr-2"></i> Add Action
      </button>
    </div>

    <div *ngIf="filteredActions.length > 0; else noActions">
      <div *ngFor="let action of filteredActions" class="action-card bg-white rounded-lg shadow mb-6 overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
          <div>
            <h3 class="text-lg font-semibold text-gray-800">{{ action.title }}</h3>
            <div class="flex items-center mt-1 space-x-2">
              <span class="status-badge"
                    [ngClass]="{
                      'status-completed': action.status === 'Completed',
                      'status-in-progress': action.status === 'In Progress',
                      'status-not-started': action.status === 'Not Started'
                    }">
                {{ action.status }}
              </span>
              <span class="hierarchy-badge">{{ action.hierarchy }}</span>
            </div>
          </div>
          <div class="text-sm text-gray-500">Due: {{ formatDate(action.dueDate) }}</div>
        </div>

        <div class="px-6 py-4">
          <p class="text-gray-600 mb-4">{{ action.description }}</p>
          <div class="text-sm text-gray-500 space-x-4">
            <span><i class="fas fa-user mr-1"></i>{{ getUserName(action.assignedTo) }}</span>
            <span *ngIf="action.relatedReportId"><i class="fas fa-file-alt mr-1"></i>{{ action.relatedReportId }}</span>
            <span *ngIf="action.manualSituationText"><i class="fas fa-info-circle mr-1"></i>{{ action.manualSituationText }}</span>
            <span *ngIf="action.completedDate"><i class="fas fa-check-circle mr-1"></i>Completed: {{ formatDate(action.completedDate) }}</span>
          </div>
        </div>

        <!-- Subactions -->
        <div *ngIf="(action.subActions || []).length > 0" class="border-t border-gray-200">
          <div class="px-6 py-3 bg-gray-50">
            <h4 class="font-medium text-gray-700">Subactions</h4>
          </div>
          <div class="divide-y divide-gray-200">
            <div *ngFor="let sub of action.subActions" class="subaction-item px-6 py-4">
              <div class="flex justify-between items-start">
                <div>
                  <h5 class="font-medium text-gray-800">{{ sub.title }}</h5>
                  <p class="text-gray-600 text-sm mt-1">{{ sub.description }}</p>
                  <div class="flex items-center mt-2 text-xs text-gray-500 space-x-4">
                    <span class="status-badge"
                          [ngClass]="{
                            'status-completed': sub.status === 'Completed',
                            'status-in-progress': sub.status === 'In Progress',
                            'status-not-started': sub.status === 'Not Started'
                          }">
                      {{ sub.status }}
                    </span>
                    <span><i class="fas fa-user mr-1"></i>{{ getUserName(sub.assignedTo) }}</span>
                    <span><i class="fas fa-calendar-alt mr-1"></i>Due: {{ formatDate(sub.dueDate) }}</span>
                    <span *ngIf="sub.completedDate"><i class="fas fa-check mr-1"></i>Completed: {{ formatDate(sub.completedDate) }}</span>
                  </div>
                </div>
                <div class="flex text-sm space-x-2">
                  <button class="text-blue-600 hover:text-blue-800"><i class="fas fa-edit"></i></button>
                  <button class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <ng-template #noActions>
      <div class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
        <i class="fas fa-inbox text-4xl mb-4"></i>
        <h3 class="text-lg font-medium">No actions found</h3>
        <p>Try adjusting filters or add new actions.</p>
      </div>
    </ng-template>
  </section>
</div>
